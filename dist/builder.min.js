/* generated on 12/2/2020 */
var Dimensions=Backbone.Model.extend({defaults:{width:5,height:5}}),DimensionsView=Backbone.View.extend({el:"#dimensions-container",initialize:function(){this.render()},events:{"click #set-dimensions":"buildPuzzleContainer"},template:'<label for="width">width: </label><input type="number" min="5" id="width" value="5"><label for="height">height: </label><input type="number" min="5" id="height" value="5"><button type="button" id="set-dimensions">GO</button>',render:function(){this.$el.html(this.template)},buildPuzzleContainer:function(){var e,i,t=parseInt($("#width").val(),10),n=parseInt($("#height").val(),10),l=0,a="";if(0<=t&&0<=n){for(this.model.set({width:t,height:n}),$("#puzzle-container").css({width:90*t,height:90*n,"grid-template-columns":"repeat("+t+", 90px)","grid-template-rows":"repeat("+n+", 90px)"}),$("#image-picker-container").css("display","flex"),$("#edit-container .hide").removeClass("hide");l<n;l++)for(a=0;a<t;a++)e=new Cell({id:i=l+"-"+a,y:l,x:a}),cellCollection.add(e),new CellView({id:i,model:e});this.remove()}}}),Buttons=Backbone.View.extend({id:"edit-container",initialize:function(){this.listenToOnce(cellCollection,"add",this.enableButtons),this.render()},events:{"click #deselect":"deselect","click #set-border":"borderButtonClickHandler","click #fixed-toggle":"toggleFixed","click #delete":"deleteImage","click #build":"buildPuzzle","click #instructions":"toggleModal","change input":"test"},template:_.template($("#button-section").html()),render:function(){this.$el.html(this.template),$("#dimensions-container").after(this.el)},toggleModal:function(){$("body").css("overflow-y","hidden"),$("#modal").addClass("show")},deselect:function(){$(".highlighted").removeClass("highlighted")},enableButtons:function(){$(".action-button").prop({disabled:!1})},borderButtonClickHandler:function(){var e;0<$(".highlighted").length&&(e=[],$(".highlighted").each(function(){e.push($(this).attr("id"))}),e.forEach(this.setBorder),this.deselect())},setBorder:function(e,i,t){var n=0,l=e.split("-"),a=parseInt(l[0],10),s=parseInt(l[1],10),l=cellCollection.findWhere({id:e}),e=a-1+"-"+s;-1===t.indexOf(e)&&(n+=2),e=a+"-"+(s+1),-1===t.indexOf(e)&&(n+=4),e=a+1+"-"+s,-1===t.indexOf(e)&&(n+=8),e=a+"-"+(s-1),-1===t.indexOf(e)&&(n+=1),l.set({border:n})},toggleFixed:function(){$(".puzzle-cell.highlighted").each(function(){var e=$(this).attr("id"),i=cellCollection.findWhere({id:e}),e=i.get("fixed");i.set({fixed:!e})}),this.deselect()},deleteImage:function(){$(".puzzle-cell.highlighted").each(function(){var e=$(this).attr("id");cellCollection.findWhere({id:e}).set({filename:""}),$(this).removeClass("highlighted")})},buildPuzzle:function(){var a=[],s=[],e=1,o=1,c=dimensions.get("width"),i=dimensions.get("height"),h={u:null,p:[],s:[]},t="INCORRECT SOLUTION";cellCollection.each(function(e){e.set({cage:""})});for(var n=0;n<i;n++)for(var l=0;l<c;l++)this.cage(l,n,0,e,c,i)&&e++;var r=picker.get("filenames");h.u=_.clone(r),this.checkResults(c,i,h.u,cellCollection)&&(cellCollection.each(function(e){var i=e.get("filename"),t=e.get("fixed"),n=e.get("border"),l=e.get("cage"),e=null;t&&(e=h.u.indexOf(i)),a.push([n,e,l,t?1:0]),s.push(h.u.indexOf(i)),o===c?(h.p.push(a.slice()),a=[],h.s.push(s.slice()),s=[],o=1):o++}),t=JSON.stringify(h)),$("#result").empty().text(t).css("display","block"),$("main").css("padding-top",$("header")[0].clientHeight)},cage:function(e,i,t,n,l,a){if(e<0||l<=e||i<0||a<=i)return!1;var s=cellCollection.findWhere({x:e,y:i}),o=s.get("border");if(""!==s.get("cage"))return!1;s.set({cage:n});var c=[e,i-1,8],h=[e+1,i,1],r=[e,i+1,2],d=[e-1,i,4];switch(o+=t){case 0:this.cage(c[0],c[1],c[2],n,l,a),this.cage(h[0],h[1],h[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 1:this.cage(c[0],c[1],c[2],n,l,a),this.cage(h[0],h[1],h[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a);break;case 2:this.cage(h[0],h[1],h[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 3:this.cage(h[0],h[1],h[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a);break;case 4:this.cage(c[0],c[1],c[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 5:this.cage(c[0],c[1],c[2],n,l,a),this.cage(r[0],r[1],r[2],n,l,a);break;case 6:this.cage(r[0],r[1],r[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 7:this.cage(r[0],r[1],r[2],n,l,a);break;case 8:this.cage(c[0],c[1],c[2],n,l,a),this.cage(h[0],h[1],h[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 9:this.cage(c[0],c[1],c[2],n,l,a),this.cage(h[0],h[1],h[2],n,l,a);break;case 10:this.cage(h[0],h[1],h[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 11:this.cage(h[0],h[1],h[2],n,l,a);break;case 12:this.cage(c[0],c[1],c[2],n,l,a),this.cage(d[0],d[1],d[2],n,l,a);break;case 13:this.cage(c[0],c[1],c[2],n,l,a);break;case 14:this.cage(d[0],d[1],d[2],n,l,a)}return!0},checkResults:function(e,i,l,t){var a=[],s=[],n=0,o=!0;if(t.each(function(e){var i=e.get("x"),t=e.get("y"),n=l.indexOf(e.get("filename")),e=e.get("cage");void 0===a[t]&&(a[t]=[]),a[t][i]=n,void 0===s[e]&&(s[e]=[]),s[e].push(n)}),s.forEach(function(e,i,t){1<e.length&&e.sort(function(e,i){return e-i});for(var n=0;n<e.length;n++)if(e[n]!==n){console.error("cage error"),o=!1;break}}),o)e:for(n=0;n<i;n++)for(var c=0;c<e;c++)if(-1!==this.cellCheck(c,n,a[n][c],a,e,i)){console.error("puzzle error"),o=!1;break e}return o},cellCheck:function(e,i,t,n,l,a){var s=[];return 0<=i-1&&(s.push(t==n[i-1][e]),e+1<l&&s.push(t==n[i-1][e+1]),0<=e-1&&s.push(t==n[i-1][e-1])),i+1<a&&(s.push(t==n[i+1][e]),e+1<l&&s.push(t==n[i+1][e+1]),0<=e-1&&s.push(t==n[i+1][e-1])),e+1<l&&s.push(t==n[i][e+1]),0<=e-1&&s.push(t==n[i][e-1]),s.indexOf(!0)}}),Cell=Backbone.Model.extend({defaults:{row:"",column:"",border:0,cage:"",fixed:!1,filename:""}}),CellCollection=Backbone.Collection.extend({model:Cell}),CellView=Backbone.View.extend({tagName:"div",className:"puzzle-cell",initialize:function(){this.listenTo(this.model,"change:border",this.changeBorder),this.listenTo(this.model,"change:fixed",this.changeFixedBackground),this.listenTo(this.model,"change:filename",this.filenameChangeActions),this.listenTo(cellCollection,"startHighlight",this.startHighlight),this.listenTo(cellCollection,"stopHighlight",this.stopHighlightEvent),this.render()},imageTemplate:_.template('<img src="./dist/images/<%= filename %>" class="png" data-filename="<%= filename %>">'),events:{mousedown:"startClickCapture",mouseup:"stopHighlight"},render:function(){var t=this;this.$el.addClass("border-"+this.model.attributes.border),$("#puzzle-container").append(this.el),this.$el.droppable({accept:".png",addClasses:!1,tolerance:"intersect",hoverClass:"droppable-hover",drop:function(e,i){$(this).droppable("disable"),t.model.set({filename:i.draggable.data("filename").toString()})}})},filenameChangeActions:function(){this.renderImage(),this.toggleBuildButton()},renderImage:function(){var e;""===this.model.attributes.filename?(this.$el.empty(),this.$el.droppable("enable")):(e=this.imageTemplate({filename:this.model.attributes.filename}),this.$el.append(e))},startClickCapture:function(){this.$el.toggleClass("highlighted"),cellCollection.trigger("startHighlight")},changeFixedBackground:function(){this.$el.toggleClass("fixed")},changeBorder:function(){this.$el.removeClass(function(e,i){return i.match(/border\-\d{1,2}/)[0]}),this.$el.addClass("border-"+this.model.attributes.border)},toggleBuildButton:function(){var e=cellCollection.where({filename:""}).length,i=$("#build").prop("disabled");0===e&&i?$("#build").prop("disabled",!1):!i&&0<e&&$("#build").prop("disabled","disabled")},startHighlight:function(){this.$el.on("mouseover",function(){$(this).addClass("highlighted")})},stopHighlight:function(){cellCollection.trigger("stopHighlight")},stopHighlightEvent:function(){this.$el.off("mouseover")}}),ImagePicker=Backbone.Model.extend({defaults:{newFilename:"",filenames:[],index:1}}),ImagePickerView=Backbone.View.extend({id:"image-picker-container",initialize:function(){this.listenTo(this.model,"change:newFilename",this.addImage),this.render()},pieceTemplate:_.template('<div class="png-container<% if (highlight) print(" current") %>"data-index="<%= index %>"><% if (filename) { %><img src="./dist/images/<%= filename %>" class="png" data-filename="<%= filename %>" /><% } else { %><%= index %><% } %></div>'),imageTemplate:_.template('<img src="./dist/images/<%= filename %>" class="png" data-filename="<%= filename %>" />'),render:function(){for(var e=1;e<=5;e++){var i=this.model.attributes.filenames[e-1];void 0===i&&(i=null),this.$el.append(this.pieceTemplate({index:e,highlight:e===this.model.attributes.index,filename:i}))}$("#controls").append(this.el)},addImage:function(e){var i=this.model.get("filenames"),i=_.clone(i);i.push(e.attributes.newFilename);e=this.imageTemplate({filename:e.attributes.newFilename});$(".png-container.current").removeClass("current"),$('div[data-index="'+this.model.attributes.index+'"]').empty().append(e),$('div[data-index="'+(this.model.attributes.index+1)+'"]').addClass("current"),this.model.set({filenames:i,index:this.model.attributes.index+1}),this.checkImageCount()},checkImageCount:function(){5===this.model.get("filenames").length&&($("#edit-container div").remove(),$(".png").draggable({addClasses:!1,revert:"invalid",helper:"clone"}))}});